<?php

/**
 * @file
 * Contains hook implementations.
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\taxonomy\Entity\Term;
use Drupal\user\Entity\User;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function dct_sessions_form_contact_message_sprint_mentor_form_form_alter(&$form, FormStateInterface $form_state, $form_id) {

  // If the user is logged in, we prepopulate the form_state.
  $currentUserId = Drupal::currentUser()->id();
  if ($currentUserId) {

    $user = User::load($currentUserId);
    $first_name = $user->get('field_first_name')->first()->value;
    $last_name = $user->get('field_last_name')->first()->value;

    $drupal_org_username = $user->get('field_drupal_org_username')->first();
    if ($drupal_org_username) {
      $drupal_org_username = $drupal_org_username->value;
    }

    $organization = $user->get('field_organization')->first();
    if ($organization) {
      $organization = $organization->target_id;
    }

    $gender = $user->get('field_gender')->first()->value;
    $shirt_size = $user->get('field_shirt_size')->first()->value;

    $form['field_first_name']['widget'][0]['value']['#default_value'] = $first_name;
    $form['field_last_name']['widget'][0]['value']['#default_value'] = $last_name;
    $form['field_drupal_org_username']['widget'][0]['value']['#default_value'] = $drupal_org_username;
    $form['field_organization']['widget'][0]['target_id']['#default_value'] = Term::load($organization);
    $form['field_gender']['widget']['#default_value'] = $gender;
    $form['field_shirt_size']['widget']['#default_value'] = $shirt_size;
  }

}
